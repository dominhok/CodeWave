<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>긴급 대피 경로</title>
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=w5mst5owqn"></script>
  <style>
    /* 스타일은 카카오맵 버전과 완전히 동일하게 유지 */
    /* ... (생략 없이 모두 복사된 스타일 - 위 코드와 동일하므로 생략 가능) ... */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🚨 긴급 대피 경로</h1>
      <p><strong id="disaster-location">서울시 강남구</strong>에서 <strong id="disaster-type">지진</strong>이 발생하였습니다.<br></p>
      <div class="emergency-info">
        <span>🕒 <span id="current-time">--:--</span></span>
        <span>📍 현 위치와의 거리: <span id="disaster-distance">3.7km</span></span>
      </div>
    </div>
    <div class="emergency-alert">
      <span>⚡ 현재 위치에서 안전한 대피소까지 경로를 안내합니다</span>
    </div>
    <div id="map"></div>
    <a id="goBtn" href="#" target="_blank">🚶‍♂️ Shelter Route Navi</a>
    <div class="status">✨ Emergency Call button</div>
  </div>

  <script>
    const disasterInfo = {
      location: '서울시 강남구',
      type: '지진',
      scale: '규모 3.5',
      time: '14:23',
      distance: '3.7km',
      coordinates: {
        lat: 37.498095,
        lng: 127.027610
      },
      radius: 5000
    };

    document.getElementById('disaster-location').textContent = disasterInfo.location;
    document.getElementById('disaster-type').textContent = disasterInfo.type;
    document.getElementById('disaster-distance').textContent = disasterInfo.distance;

    function updateCurrentTime() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      document.getElementById('current-time').textContent = `${hours}:${minutes}`;
    }
    updateCurrentTime();
    setInterval(updateCurrentTime, 60000);

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        const map = new naver.maps.Map('map', {
          center: new naver.maps.LatLng(lat, lng),
          zoom: 13
        });

        const currentPosition = new naver.maps.LatLng(lat, lng);
        const disasterPosition = new naver.maps.LatLng(disasterInfo.coordinates.lat, disasterInfo.coordinates.lng);

        // 현재 위치 마커
        const currentMarker = new naver.maps.Marker({
          position: currentPosition,
          map: map,
          icon: {
            content: '<div class="info-window">📍 현재 위치</div>',
            size: new naver.maps.Size(30, 30),
            anchor: new naver.maps.Point(15, 15)
          }
        });

        // 재난 발생 위치 마커
        const disasterMarker = new naver.maps.Marker({
          position: disasterPosition,
          map: map,
          icon: {
            content: '<div class="info-window" style="background: rgba(255, 59, 48, 0.1); border-color: rgba(255, 59, 48, 0.5);">⚠️ 재난 발생 지점</div>',
            size: new naver.maps.Size(30, 30),
            anchor: new naver.maps.Point(15, 15)
          }
        });

        // 위험 반경 원
        const circle = new naver.maps.Circle({
          map: map,
          center: disasterPosition,
          radius: disasterInfo.radius,
          strokeColor: '#FF3B30',
          strokeOpacity: 0.7,
          strokeWeight: 2,
          fillColor: '#FF3B30',
          fillOpacity: 0.15
        });

        // 현재 위치, 재난 위치 포함하도록 뷰 조정
        const bounds = new naver.maps.LatLngBounds();
        bounds.extend(currentPosition);
        bounds.extend(disasterPosition);
        map.fitBounds(bounds);

        // 가장 가까운 대피소 찾기 (시장 대신 fixed 좌표 예시)
        const shelterLat = 37.501274;  // 예: 삼성1동 주민센터
        const shelterLng = 127.039585;
        const shelterName = "삼성1동 주민센터";

        const shelterPosition = new naver.maps.LatLng(shelterLat, shelterLng);
        const shelterMarker = new naver.maps.Marker({
          position: shelterPosition,
          map: map,
          icon: {
            content: `<div class="info-window">${shelterName} 🏥</div>`,
            size: new naver.maps.Size(30, 30),
            anchor: new naver.maps.Point(15, 15)
          }
        });

        setTimeout(() => {
          const shelterBounds = new naver.maps.LatLngBounds();
          shelterBounds.extend(currentPosition);
          shelterBounds.extend(shelterPosition);
          map.fitBounds(shelterBounds);

          const centerLat = (currentPosition.lat() + shelterPosition.lat()) / 2;
          const centerLng = (currentPosition.lng() + shelterPosition.lng()) / 2;
          map.panTo(new naver.maps.LatLng(centerLat, centerLng));

          document.querySelector('.status').textContent = 
            '✨ 가장 가까운 대피소까지의 안전한 경로를 확인해주세요.';
        }, 2000);

        // 경로 이동 버튼 설정
        const goBtn = document.getElementById("goBtn");
        const naviURL = `https://map.naver.com/v5/directions/${lng},${lat},출발지/${shelterLng},${shelterLat},${shelterName}/walk`;
        goBtn.href = naviURL;
        goBtn.style.display = 'block';
      });
    } else {
      alert("위치 정보를 사용할 수 없습니다.");
    }
  </script>
</body>
</html>
