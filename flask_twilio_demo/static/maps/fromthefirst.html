<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ê¸´ê¸‰ ëŒ€í”¼ ê²½ë¡œ</title>
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=w5mst5owqn"></script>
  <style>
    /* ìŠ¤íƒ€ì¼ì€ ì¹´ì¹´ì˜¤ë§µ ë²„ì „ê³¼ ì™„ì „íˆ ë™ì¼í•˜ê²Œ ìœ ì§€ */
    /* ... (ìƒëµ ì—†ì´ ëª¨ë‘ ë³µì‚¬ëœ ìŠ¤íƒ€ì¼ - ìœ„ ì½”ë“œì™€ ë™ì¼í•˜ë¯€ë¡œ ìƒëµ ê°€ëŠ¥) ... */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸš¨ ê¸´ê¸‰ ëŒ€í”¼ ê²½ë¡œ</h1>
      <p><strong id="disaster-location">ì„œìš¸ì‹œ ê°•ë‚¨êµ¬</strong>ì—ì„œ <strong id="disaster-type">ì§€ì§„</strong>ì´ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.<br></p>
      <div class="emergency-info">
        <span>ğŸ•’ <span id="current-time">--:--</span></span>
        <span>ğŸ“ í˜„ ìœ„ì¹˜ì™€ì˜ ê±°ë¦¬: <span id="disaster-distance">3.7km</span></span>
      </div>
    </div>
    <div class="emergency-alert">
      <span>âš¡ í˜„ì¬ ìœ„ì¹˜ì—ì„œ ì•ˆì „í•œ ëŒ€í”¼ì†Œê¹Œì§€ ê²½ë¡œë¥¼ ì•ˆë‚´í•©ë‹ˆë‹¤</span>
    </div>
    <div id="map"></div>
    <a id="goBtn" href="#" target="_blank">ğŸš¶â€â™‚ï¸ Shelter Route Navi</a>
    <div class="status">âœ¨ Emergency Call button</div>
  </div>

  <script>
    const disasterInfo = {
      location: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬',
      type: 'ì§€ì§„',
      scale: 'ê·œëª¨ 3.5',
      time: '14:23',
      distance: '3.7km',
      coordinates: {
        lat: 37.498095,
        lng: 127.027610
      },
      radius: 5000
    };

    document.getElementById('disaster-location').textContent = disasterInfo.location;
    document.getElementById('disaster-type').textContent = disasterInfo.type;
    document.getElementById('disaster-distance').textContent = disasterInfo.distance;

    function updateCurrentTime() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      document.getElementById('current-time').textContent = `${hours}:${minutes}`;
    }
    updateCurrentTime();
    setInterval(updateCurrentTime, 60000);

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        const lat = position.coords.latitude;
        const lng = position.coords.longitude;

        const map = new naver.maps.Map('map', {
          center: new naver.maps.LatLng(lat, lng),
          zoom: 13
        });

        const currentPosition = new naver.maps.LatLng(lat, lng);
        const disasterPosition = new naver.maps.LatLng(disasterInfo.coordinates.lat, disasterInfo.coordinates.lng);

        // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤
        const currentMarker = new naver.maps.Marker({
          position: currentPosition,
          map: map,
          icon: {
            content: '<div class="info-window">ğŸ“ í˜„ì¬ ìœ„ì¹˜</div>',
            size: new naver.maps.Size(30, 30),
            anchor: new naver.maps.Point(15, 15)
          }
        });

        // ì¬ë‚œ ë°œìƒ ìœ„ì¹˜ ë§ˆì»¤
        const disasterMarker = new naver.maps.Marker({
          position: disasterPosition,
          map: map,
          icon: {
            content: '<div class="info-window" style="background: rgba(255, 59, 48, 0.1); border-color: rgba(255, 59, 48, 0.5);">âš ï¸ ì¬ë‚œ ë°œìƒ ì§€ì </div>',
            size: new naver.maps.Size(30, 30),
            anchor: new naver.maps.Point(15, 15)
          }
        });

        // ìœ„í—˜ ë°˜ê²½ ì›
        const circle = new naver.maps.Circle({
          map: map,
          center: disasterPosition,
          radius: disasterInfo.radius,
          strokeColor: '#FF3B30',
          strokeOpacity: 0.7,
          strokeWeight: 2,
          fillColor: '#FF3B30',
          fillOpacity: 0.15
        });

        // í˜„ì¬ ìœ„ì¹˜, ì¬ë‚œ ìœ„ì¹˜ í¬í•¨í•˜ë„ë¡ ë·° ì¡°ì •
        const bounds = new naver.maps.LatLngBounds();
        bounds.extend(currentPosition);
        bounds.extend(disasterPosition);
        map.fitBounds(bounds);

        // ê°€ì¥ ê°€ê¹Œìš´ ëŒ€í”¼ì†Œ ì°¾ê¸° (ì‹œì¥ ëŒ€ì‹  fixed ì¢Œí‘œ ì˜ˆì‹œ)
        const shelterLat = 37.501274;  // ì˜ˆ: ì‚¼ì„±1ë™ ì£¼ë¯¼ì„¼í„°
        const shelterLng = 127.039585;
        const shelterName = "ì‚¼ì„±1ë™ ì£¼ë¯¼ì„¼í„°";

        const shelterPosition = new naver.maps.LatLng(shelterLat, shelterLng);
        const shelterMarker = new naver.maps.Marker({
          position: shelterPosition,
          map: map,
          icon: {
            content: `<div class="info-window">${shelterName} ğŸ¥</div>`,
            size: new naver.maps.Size(30, 30),
            anchor: new naver.maps.Point(15, 15)
          }
        });

        setTimeout(() => {
          const shelterBounds = new naver.maps.LatLngBounds();
          shelterBounds.extend(currentPosition);
          shelterBounds.extend(shelterPosition);
          map.fitBounds(shelterBounds);

          const centerLat = (currentPosition.lat() + shelterPosition.lat()) / 2;
          const centerLng = (currentPosition.lng() + shelterPosition.lng()) / 2;
          map.panTo(new naver.maps.LatLng(centerLat, centerLng));

          document.querySelector('.status').textContent = 
            'âœ¨ ê°€ì¥ ê°€ê¹Œìš´ ëŒ€í”¼ì†Œê¹Œì§€ì˜ ì•ˆì „í•œ ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.';
        }, 2000);

        // ê²½ë¡œ ì´ë™ ë²„íŠ¼ ì„¤ì •
        const goBtn = document.getElementById("goBtn");
        const naviURL = `https://map.naver.com/v5/directions/${lng},${lat},ì¶œë°œì§€/${shelterLng},${shelterLat},${shelterName}/walk`;
        goBtn.href = naviURL;
        goBtn.style.display = 'block';
      });
    } else {
      alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
  </script>
</body>
</html>
